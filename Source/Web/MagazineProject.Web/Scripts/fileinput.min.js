/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version 4.1.8
 *
 * File input styled for Bootstrap 3.0 that utilizes HTML5 File Input's advanced 
 * features including the FileReader API. 
 * 
 * The plugin drastically enhances the HTML file input to preview multiple files on the client before
 * upload. In addition it provides the ability to preview content of images, text, videos, audio, html, 
 * flash and other objects. It also offers the ability to upload and delete files using AJAX, and add 
 * files in batches (i.e. preview, append, or remove before upload).
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(n){"use strict";String.prototype.repl=function(n,t){return this.split(n).join(t)};var h=function(n){var t=document.createElement("div"),i;return t.innerHTML="<!--[if IE "+n+"]><i><\/i><![endif]-->",i=t.getElementsByTagName("i").length===1,document.body.appendChild(t),t.parentNode.removeChild(t),i},t={data:{},init:function(n){var i=n.initialPreview,r=n.id;i.length>0&&!c(i)&&(i=i.split(n.initialPreviewDelimiter));t.data[r]={content:i,config:n.initialPreviewConfig,tags:n.initialPreviewThumbTags,delimiter:n.initialPreviewDelimiter,template:n.previewGenericTemplate,msg:n.msgSelected,initId:n.previewInitId,footer:n.getLayoutTemplate("footer"),isDelete:n.initialPreviewShowDelete,caption:n.initialCaption,actions:function(t,i,r,u,f,e){return n.renderFileActions(t,i,r,u,f,e)}}},fetch:function(n){return t.data[n].content.filter(function(n){return n!==undefined})},count:function(n){return!!t.data[n]&&!!t.data[n].content?t.fetch(n).length:0},get:function(n,i,r){var e="init_"+i,u=t.data[n],o=u.initId+"-"+e,f;return(r=r===undefined?!0:r,u.content[i]===undefined)?"":(f=u.template.repl("{previewId}",o).repl("{frameClass}"," file-preview-initial").repl("{fileindex}",e).repl("{content}",u.content[i]).repl("{footer}",t.footer(n,i,r)),u.tags.length&&u.tags[i]&&(f=y(f,u.tags[i])),f)},add:function(i,r,u,f){var e=n.extend(!0,{},t.data[i]),o;return c(r)||(r=r.split(e.delimiter)),f?(o=e.content.push(r)-1,e.config[o]=u):(o=r.length,e.content=r,e.config=u),t.data[i]=e,o},set:function(i,r,u,f,e){var s=n.extend(!0,{},t.data[i]),o;if(c(r)||(r=r.split(s.delimiter)),e){for(o=0;o<r.length;o++)s.content.push(r[o]);for(o=0;o<u.length;o++)s.config.push(u[o]);for(o=0;o<f.length;o++)s.tags.push(f[o])}else s.content=r,s.config=u,s.tags=f;t.data[i]=s},unset:function(n,i){var r=t.count(n);if(r){if(r===1){t.data[n].content=[];t.data[n].config=[];return}t.data[n].content[i]=undefined;t.data[n].config[i]=undefined}},out:function(n){var u="",e=t.data[n],f,r=t.count(n),i;if(r===0)return{content:"",caption:""};for(i=0;i<r;i++)u+=t.get(n,i);return f=e.msg.repl("{n}",r),{content:u,caption:f}},footer:function(n,r,u){var o=t.data[n];if(u=u===undefined?!0:u,o.config.length===0||i(o.config[r]))return"";var e=o.config[r],h=f("caption",e)?e.caption:"",c=f("width",e)?e.width:"auto",s=f("url",e)?e.url:!1,l=f("key",e)?e.key:null,a=s===!1&&u,v=o.isDelete?o.actions(!1,!0,a,s,l,r):"",y=o.footer.repl("{actions}",v);return y.repl("{caption}",h).repl("{width}",c).repl("{indicator}","").repl("{indicatorTitle}","")}},u=".file-preview-frame:not(.file-preview-initial)",tt=function(n,t){return(t=t||0,typeof n=="number")?n:(typeof n=="string"&&(n=parseFloat(n)),isNaN(n)?t:n)},w=function(){return window.File&&window.FileReader},it=function(){var n=document.createElement("div");return!h(9)&&(n.draggable!==undefined||n.ondragstart!==undefined&&n.ondrop!==undefined)},rt=function(){return w&&window.FormData},r=function(n,t){n.removeClass(t).addClass(t)},e='style="width:{width};height:{height};"',k='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',o='<div class="file-preview-other">\n       {previewFileIcon}\n   <\/div>',ut={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"><\/i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"><\/i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"><\/i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"><\/i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"><\/i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"><\/i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},ft='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       '+o+"\n    <\/object>\n   {footer}\n<\/div>",et='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+e+">\n   {footer}\n<\/div>\n",ot='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" '+e+">\n       {data}\n   <\/div>\n   {footer}\n<\/div>",st='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+e+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+o+"\n   <\/video>\n   {footer}\n<\/div>\n",ht='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+e+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+o+"\n   <\/audio>\n   {footer}\n<\/div>",ct='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+e+'>\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+k+"       "+o+"\n   <\/object>\n   {footer}\n<\/div>\n",lt='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+e+'>\n   <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+k+"         "+o+"\n   <\/object>\n   {footer}\n<\/div>",at='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+e+">\n   "+o+"\n   {footer}\n<\/div>",d={main1:'{preview}\n<div class="kv-upload-progress hide"><\/div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   <\/div>\n<\/div>',main2:'{preview}\n<div class="kv-upload-progress hide"><\/div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',preview:'<div class="file-preview {class}">\n    <div class="close fileinput-remove">&times;<\/div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    <\/div>\n    <div class="clearfix"><\/div>    <div class="file-preview-status text-center text-success"><\/div>\n    <div class="kv-fileinput-error"><\/div>\n    <\/div>\n<\/div>',icon:'<span class="glyphicon glyphicon-file kv-caption-icon"><\/span>',caption:'<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;<\/span>\n   <div class="file-caption-name"><\/div>\n<\/div>',modal:'<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;<\/button>\n        <h3 class="modal-title">Detailed Preview <small>{title}<\/small><\/h3>\n      <\/div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}<\/textarea>\n      <\/div>\n    <\/div>\n  <\/div>\n<\/div>',progress:'<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     <\/div>\n<\/div>',footer:'<div class="file-thumbnail-footer">\n    <div class="file-caption-name">{caption}<\/div>\n    {actions}\n<\/div>',actions:'<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    <\/div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}<\/div>\n    <div class="clearfix"><\/div>\n<\/div>',actionDelete:'<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}<\/button>\n',actionUpload:'<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n<\/button>\n'},g={generic:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n<\/div>\n',html:ft,image:et,text:ot,video:st,audio:ht,flash:ct,object:lt,other:at},a=["image","html","text","video","audio","flash","object"],nt={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},b={image:function(n,t){return n!==undefined?n.match("image.*"):t.match(/\.(gif|png|jpe?g)$/i)},html:function(n,t){return n!==undefined?n==="text/html":t.match(/\.(htm|html)$/i)},text:function(n,t){return n!==undefined&&n.match("text.*")||t.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(n,t){return n!==undefined&&n.match(/\.video\/(ogg|mp4|webm)$/i)||t.match(/\.(og?|mp4|webm)$/i)},audio:function(n,t){return n!==undefined&&n.match(/\.audio\/(ogg|mp3|wav)$/i)||t.match(/\.(ogg|mp3|wav)$/i)},flash:function(n,t){return n!==undefined&&n==="application/x-shockwave-flash"||t.match(/\.(swf)$/i)},object:function(){return!0},other:function(){return!0}},i=function(t,i){return t===null||t===undefined||t.length===0||i&&n.trim(t)===""},c=function(n){return Array.isArray(n)||Object.prototype.toString.call(n)==="[object Array]"},f=function(n,t){return typeof t=="object"&&n in t},s=function(t,r,u){return i(t)||i(t[r])?u:n(t[r])},v=function(){return Math.round((new Date).getTime()+Math.random()*100)},vt=function(n){return String(n).repl("&","&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;")},y=function(t,i){var r=t;return i=i||{},n.each(i,function(n,t){typeof t=="function"&&(t=t());r=r.repl(n,t)}),r},l=window.URL||window.webkitURL,p=function(t,i){this.$element=n(t);w()||h(9)?(this.init(i),this.listen()):this.$element.removeClass("file-loading")};p.prototype={constructor:p,init:function(u){var f=this,o=f.$element,e;n.each(u,function(n,t){(n==="maxFileCount"||n==="maxFileSize")&&(f[n]=tt(t));f[n]=t});f.fileInputCleared=!1;f.fileBatchCompleted=!0;i(f.allowedPreviewTypes)&&(f.allowedPreviewTypes=a);f.uploadFileAttr=i(o.attr("name"))?"file_data":o.attr("name");f.reader=null;f.formdata={};f.isIE9=h(9);f.isIE10=h(10);f.filestack=[];f.ajaxRequests=[];f.isError=!1;f.uploadAborted=!1;f.dropZoneEnabled=it()&&f.dropZoneEnabled;f.isDisabled=f.$element.attr("disabled")||f.$element.attr("readonly");f.isUploadable=rt&&!i(f.uploadUrl);f.slug=typeof u.slugCallback=="function"?u.slugCallback:f.slugDefault;f.mainTemplate=f.showCaption?f.getLayoutTemplate("main1"):f.getLayoutTemplate("main2");f.captionTemplate=f.getLayoutTemplate("caption");f.previewGenericTemplate=f.getPreviewTemplate("generic");i(f.$element.attr("id"))&&f.$element.attr("id",v());f.$container===undefined?f.$container=f.createContainer():f.refreshContainer();f.$progress=f.$container.find(".kv-upload-progress");f.$btnUpload=f.$container.find(".kv-fileinput-upload");f.$captionContainer=s(u,"elCaptionContainer",f.$container.find(".file-caption"));f.$caption=s(u,"elCaptionText",f.$container.find(".file-caption-name"));f.$previewContainer=s(u,"elPreviewContainer",f.$container.find(".file-preview"));f.$preview=s(u,"elPreviewImage",f.$container.find(".file-preview-thumbnails"));f.$previewStatus=s(u,"elPreviewStatus",f.$container.find(".file-preview-status"));f.$errorContainer=s(u,"elErrorContainer",f.$previewContainer.find(".kv-fileinput-error"));i(f.msgErrorClass)||r(f.$errorContainer,f.msgErrorClass);f.$errorContainer.hide();f.fileActionSettings=n.extend(ut,u.fileActionSettings);f.previewInitId="preview-"+v();f.id=f.$element.attr("id");t.init(f);f.initPreview(!0);f.initPreviewDeletes();f.options=u;f.setFileDropZoneTitle();f.uploadCount=0;f.uploadPercent=0;f.$element.removeClass("file-loading");e=f.getLayoutTemplate("progress");f.progressTemplate=e.replace("{class}",f.progressClass);f.progressCompleteTemplate=e.replace("{class}",f.progressCompleteClass);f.setEllipsis()},parseError:function(t,i,r){var o=this,f=n.trim(i+""),e=f.slice(-1)==="."?"":".",u=n(t.responseText).text();return o.showAjaxErrorDetails?(u=n.trim(u.replace(/\n\s*\n/g,"\n")),u=u.length>0?"<pre>"+u+"<\/pre>":"",f+=e+u):f+=e,r?"<b>"+r+": <\/b>"+t:f},raise:function(t,i){var r=this,u=n.Event(t),f;if(i!==undefined?r.$element.trigger(u,i):r.$element.trigger(u),f=u.result||!1,f)switch(t){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":break;default:r.uploadAborted=f}},getLayoutTemplate:function(n){var t=this,r=f(n,t.layoutTemplates)?t.layoutTemplates[n]:d[n];return i(t.customLayoutTags)?r:y(r,t.customLayoutTags)},getPreviewTemplate:function(n){var t=this,r=f(n,t.previewTemplates)?t.previewTemplates[n]:g[n];return(r=r.repl("{previewFileIcon}",t.previewFileIcon),i(t.customPreviewTags))?r:y(r,t.customPreviewTags)},getOutData:function(n,t,i){var r=this;return n=n||{},t=t||{},i=i||r.filestack.slice(0)||{},{form:r.formdata,files:i,extra:r.getExtraData(),response:t,reader:r.reader,jqXHR:n}},setEllipsis:function(){var i=this,n=i.$captionContainer,r=i.$caption,t=r.clone().css("height","auto").hide();n.parent().before(t);n.removeClass("kv-has-ellipsis");t.outerWidth()>r.outerWidth()&&n.addClass("kv-has-ellipsis");t.remove()},listen:function(){var t=this,r=t.$element,f=t.$captionContainer,e=t.$btnFile,u=r.closest("form");r.on("change",n.proxy(t.change,t));n(window).on("resize",function(){t.setEllipsis()});e.off("click").on("click",function(){t.raise("filebrowse");t.isError&&!t.isUploadable&&t.clear();f.focus()});u.off("reset").on("reset",n.proxy(t.reset,t));t.$container.off("click").on("click",".fileinput-remove:not([disabled])",n.proxy(t.clear,t)).on("click",".fileinput-cancel",n.proxy(t.cancel,t));if(t.isUploadable&&t.dropZoneEnabled&&t.showPreview&&t.initDragDrop(),!t.isUploadable)u.on("submit",n.proxy(t.submitForm,t));t.$container.find(".kv-fileinput-upload").off("click").on("click",function(r){t.isUploadable&&(r.preventDefault(),!n(this).hasClass("disabled")&&i(n(this).attr("disabled"))&&t.upload())})},submitForm:function(){var n=this,i=n.$element,t=i.get(0).files;return t&&t.length<n.minFileCount&&n.minFileCount>0?(n.noFilesError({}),!1):!n.abort({})},abort:function(t){var i=this,r;return i.uploadAborted&&typeof i.uploadAborted=="object"&&i.uploadAborted.message!==undefined?(r=i.uploadAborted.data!==undefined?i.getOutData({},i.uploadAborted.data):i.getOutData(),r=n.extend(r,t),i.showUploadError(i.uploadAborted.message,r,"filecustomerror"),!0):!1},noFilesError:function(n){var t=this,u=t.minFileCount>1?t.filePlural:t.fileSingle,f=t.msgFilesTooLess.repl("{n}",t.minFileCount).repl("{files}",u),i=t.$errorContainer;i.html(f);t.isError=!0;t.updateFileDetails(0);i.fadeIn(800);t.raise("fileerror",[n]);t.clearFileInput();r(t.$container,"has-error")},setProgress:function(n){var t=this,i=Math.min(n,100),r=i<100?t.progressTemplate:t.progressCompleteTemplate;t.$progress.html(r.repl("{percent}",i))},upload:function(){var t=this,r=t.getFileStack().length,i,u,f,e=!n.isEmptyObject(t.getExtraData());if(r<t.minFileCount&&t.minFileCount>0){t.noFilesError({});return}if(t.isUploadable&&!t.isDisabled&&(r!==0||e)){if(t.resetUpload(),t.$progress.removeClass("hide"),t.uploadCount=0,t.uploadPercent=0,t.lock(),t.setProgress(0),r===0&&e){t.uploadExtraOnly();return}if(f=t.filestack.length,t.hasInitData=!1,t.uploadAsync&&t.showPreview){for(u=t.getOutData(),t.raise("filebatchpreupload",[u]),t.fileBatchCompleted=!1,t.uploadCache={content:[],config:[],tags:[],append:!0},i=0;i<f;i+=1)t.filestack[i]!==undefined&&t.uploadSingle(i,t.filestack,!0);return}t.uploadBatch()}},lock:function(){var n=this;n.resetErrors();n.disable();n.showRemove&&r(n.$container.find(".fileinput-remove"),"hide");n.showCancel&&n.$container.find(".fileinput-cancel").removeClass("hide");n.raise("filelock",[n.filestack,n.getExtraData()])},unlock:function(n){var t=this;n===undefined&&(n=!0);t.enable();t.showCancel&&r(t.$container.find(".fileinput-cancel"),"hide");t.showRemove&&t.$container.find(".fileinput-remove").removeClass("hide");n&&t.resetFileStack();t.raise("fileunlock",[t.filestack,t.getExtraData()])},resetFileStack:function(){var t=this,i=0,r=[];t.$preview.find(u).each(function(){var u=n(this),f=u.attr("data-fileindex"),e=t.filestack[f];f!==-1&&(e!==undefined?(r[i]=e,u.attr({id:t.previewInitId+"-"+i,"data-fileindex":i}),i+=1):u.attr({id:"uploaded-"+v(),"data-fileindex":"-1"}))});t.filestack=r},refresh:function(t){var i=this,u=i.$element,r,f=arguments.length?n.extend(i.options,t):i.options;u.off();i.init(f);r=i.$container.find(".file-drop-zone");r.off("dragenter dragover drop");n(document).off("dragenter dragover drop");i.listen();i.setFileDropZoneTitle()},initDragDrop:function(){var t=this,i=t.$container.find(".file-drop-zone");i.off("dragenter dragover drop");n(document).off("dragenter dragover drop");i.on("dragenter dragover",function(i){(i.stopPropagation(),i.preventDefault(),t.isDisabled)||r(n(this),"highlighted")});i.on("dragleave",function(i){(i.stopPropagation(),i.preventDefault(),t.isDisabled)||n(this).removeClass("highlighted")});i.on("drop",function(i){(i.preventDefault(),t.isDisabled)||(t.change(i,"dragdrop"),n(this).removeClass("highlighted"))});n(document).on("dragenter dragover drop",function(n){n.stopPropagation();n.preventDefault()})},setFileDropZoneTitle:function(){var n=this,t=n.$container.find(".file-drop-zone");(t.find("."+n.dropZoneTitleClass).remove(),n.isUploadable&&n.showPreview&&t.length!==0&&!(n.getFileStack().length>0)&&n.dropZoneEnabled)&&(t.find(".file-preview-frame").length===0&&t.prepend('<div class="'+n.dropZoneTitleClass+'">'+n.dropZoneTitle+"<\/div>"),n.$container.removeClass("file-input-new"),r(n.$container,"file-input-ajax-new"))},initFileActions:function(){var i=this;i.$preview.find(".kv-file-remove").each(function(){var f=n(this),r=f.closest(".file-preview-frame"),o=r.attr("data-fileindex"),u,e;f.off("click").on("click",function(){r.fadeOut("slow",function(){i.filestack[o]=undefined;i.clearObjects(r);r.remove();var n=i.getFileStack(),f=n.length,s=t.count(i.id);i.clearFileInput();f===0&&s===0?i.reset():(u=s+f,e=u>1?i.msgSelected.repl("{n}",u):n[0].name,i.setCaption(e))})})});i.$preview.find(".kv-file-upload").each(function(){var t=n(this);t.off("click").on("click",function(){var n=t.closest(".file-preview-frame"),r=n.attr("data-fileindex");i.uploadSingle(r,i.filestack,!1)})})},renderFileFooter:function(n,t){var i=this,u=i.fileActionSettings,f,r,e=i.getLayoutTemplate("footer");return i.isUploadable?(f=e.repl("{actions}",i.renderFileActions(!0,!0,!1,!1,!1,!1)),r=f.repl("{caption}",n).repl("{width}",t).repl("{indicator}",u.indicatorNew).repl("{indicatorTitle}",u.indicatorNewTitle)):r=e.repl("{actions}","").repl("{caption}",n).repl("{width}",t).repl("{indicator}","").repl("{indicatorTitle}",""),y(r,i.previewThumbTags)},renderFileActions:function(n,t,i,r,u){if(!n&&!t)return"";var e=this,c=r===!1?"":' data-url="'+r+'"',s=u===!1?"":' data-key="'+u+'"',o=e.getLayoutTemplate("actionDelete"),h="",l=e.getLayoutTemplate("actions"),a=e.otherActionButtons.repl("{dataKey}",s),f=e.fileActionSettings,v=i?f.removeClass+" disabled":f.removeClass;return o=o.repl("{removeClass}",v).repl("{removeIcon}",f.removeIcon).repl("{removeTitle}",f.removeTitle).repl("{dataUrl}",c).repl("{dataKey}",s),n&&(h=e.getLayoutTemplate("actionUpload").repl("{uploadClass}",f.uploadClass).repl("{uploadIcon}",f.uploadIcon).repl("{uploadTitle}",f.uploadTitle)),l.repl("{delete}",o).repl("{upload}",h).repl("{other}",a)},initPreview:function(n){var r=this,f,u;if(!t.count(r.id)){r.$preview.html("");r.setCaption("");return}u=t.out(r.id);f=n&&r.initialCaption?r.initialCaption:u.caption;r.$preview.html(u.content);r.setCaption(f);i(u.content)||r.$container.removeClass("file-input-new")},initPreviewDeletes:function(){var u=this,e=u.deleteExtraData||{},f=function(){u.$preview.find(".kv-file-remove").length===0&&u.reset()};u.$preview.find(".kv-file-remove").each(function(){var h=n(this),o=h.closest(".file-preview-frame"),y=t.data[u.id],a,v,s,p=h.data("url")||u.deleteUrl,l=h.data("key"),w,c={id:h.attr("id"),key:l,extra:s};if(typeof s=="function"&&(s=s()),p!==undefined&&l!==undefined){w=n.extend({url:p,type:"DELETE",dataType:"json",data:n.extend({key:l},s),beforeSend:function(n){r(o,"file-uploading");r(h,"disabled");u.raise("filepredelete",[l,n,s])},success:function(n,r,p){if(a=parseInt(o.data("fileindex").replace("init_","")),v=i(y.config)&&i(y.config[a])?null:y.config[a],s=i(v)||i(v.extra)?e:v.extra,n===undefined||n.error===undefined)t.unset(u.id,a),u.raise("filedeleted",[l,p,s]);else{c.jqXHR=p;c.response=n;u.showError(n.error,c,"filedeleteerror");o.removeClass("file-uploading");h.removeClass("disabled");f();return}o.removeClass("file-uploading").addClass("file-deleted");o.fadeOut("slow",function(){u.clearObjects(o);o.remove();f();t.count(u.id)||u.reset()})},error:function(n,t,i){var r=u.parseError(n,i);c.jqXHR=n;c.response={};u.showError(r,c,"filedeleteerror");o.removeClass("file-uploading");f()}},u.ajaxDeleteSettings);h.off("click").on("click",function(){n.ajax(w)})}})},clearObjects:function(t){t.find("video audio").each(function(){this.pause();n(this).remove()});t.find("img object div").each(function(){n(this).remove()})},clearFileInput:function(){var u=this,t=u.$element,e,r,f;i(t.val())||(u.isIE9||u.isIE10?(e=t.closest("form"),r=n(document.createElement("form")),f=n(document.createElement("div")),t.before(f),e.length?e.after(r):f.after(r),r.append(t).trigger("reset"),f.before(t).remove(),r.remove()):t.val(""),u.fileInputCleared=!0)},resetUpload:function(){var n=this;n.uploadCache={content:[],config:[],tags:[],append:!0};n.uploadCount=0;n.uploadPercent=0;n.$btnUpload.removeAttr("disabled");n.setProgress(0);r(n.$progress,"hide");n.resetErrors(!1);n.uploadAborted=!1;n.ajaxRequests=[]},cancel:function(){var t=this,r=t.ajaxRequests,f=r.length,i;if(f>0)for(i=0;i<f;i+=1)r[i].abort();t.$preview.find(u).each(function(){var i=n(this),r=i.attr("data-fileindex");i.removeClass("file-uploading");t.filestack[r]!==undefined&&(i.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),i.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled"));t.unlock()})},clear:function(){var i=this,f;i.$btnUpload.removeAttr("disabled");i.resetUpload();i.filestack=[];i.clearFileInput();i.resetErrors(!0);i.raise("fileclear");!i.overwriteInitial&&t.count(i.id)?(i.showFileIcon(),i.resetPreview(),i.setEllipsis(),i.initPreviewDeletes(),i.$container.removeClass("file-input-new")):(i.$preview.find(u).each(function(){i.clearObjects(n(this))}),i.$preview.html(""),f=!i.overwriteInitial&&i.initialCaption.length>0?i.initialCaption:"",i.$caption.html(f),i.setEllipsis(),i.$caption.attr("title",""),r(i.$container,"file-input-new"));i.$container.find(".file-preview-frame").length===0&&(i.initialCaption="",i.$caption.html(""),i.setEllipsis(),i.$captionContainer.find(".kv-caption-icon").hide());i.hideFileIcon();i.raise("filecleared");i.$captionContainer.focus();i.setFileDropZoneTitle()},resetPreview:function(){var n=this,i;t.count(n.id)?(i=t.out(n.id),n.$preview.html(i.content),n.setCaption(i.caption)):(n.$preview.html(""),n.$caption.html(""))},reset:function(){var n=this;n.clear();n.resetPreview();n.setEllipsis();n.$container.find(".fileinput-filename").text("");n.raise("filereset");n.initialPreview.length>0&&n.$container.removeClass("file-input-new");n.setFileDropZoneTitle();n.filestack=[];n.formdata={}},disable:function(){var n=this;n.isDisabled=!0;n.raise("filedisabled");n.$element.attr("disabled","disabled");n.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");n.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",!0);n.initDragDrop()},enable:function(){var n=this;n.isDisabled=!1;n.raise("fileenabled");n.$element.removeAttr("disabled");n.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");n.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled");n.initDragDrop()},getExtraData:function(){var n=this,t=n.uploadExtraData;return typeof n.uploadExtraData=="function"&&(t=n.uploadExtraData()),t},uploadExtra:function(){var t=this,i=t.getExtraData();i.length!==0&&n.each(i,function(n,i){t.formdata.append(n,i)})},initXhr:function(n,t){var i=this;return n.upload&&n.upload.addEventListener("progress",function(n){var r=0,u=n.loaded||n.position,f=n.total;n.lengthComputable&&(r=Math.ceil(u/f*t));i.uploadPercent=Math.max(r,i.uploadPercent);i.setProgress(i.uploadPercent)},!1),n},ajaxSubmit:function(t,i,r,u){var f=this,e;f.uploadExtra();e=n.extend({xhr:function(){var t=n.ajaxSettings.xhr();return f.initXhr(t,98)},url:f.uploadUrl,type:"POST",dataType:"json",data:f.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:t,success:i,complete:r,error:u},f.ajaxSettings);f.ajaxRequests.push(n.ajax(e))},initUploadSuccess:function(i,r,u){var f=this,e,l,a,c,o,s,h;typeof i!="object"||n.isEmptyObject(i)||i.initialPreview!==undefined&&i.initialPreview.length>0&&(f.hasInitData=!0,o=i.initialPreview||[],s=i.initialPreviewConfig||[],h=i.initialPreviewThumbTags||[],e=i.append===undefined||i.append?!0:!1,f.overwriteInitial=!1,r===undefined||!u?u?(f.uploadCache.content.push(o[0]),f.uploadCache.config.push(s[0]),f.uploadCache.tags.push(h[0]),f.uploadCache.append=e):(t.set(f.id,o,s,h,e),f.initPreview(),f.initPreviewDeletes()):(a=t.add(f.id,o,s[0],h[0],e),l=t.get(f.id,a,!1),c=n(l).hide(),r.after(c).fadeOut("slow",function(){c.fadeIn("slow").css("display:inline-block");f.initPreviewDeletes()})))},uploadSingle:function(i,f,e){var o=this,y=o.getFileStack().length,p=new FormData,h,a=o.previewInitId+"-"+i,c=n("#"+a+":not(.file-preview-initial)"),b,k,v=c.find(".kv-file-upload"),w=c.find(".kv-file-remove"),d=c.find(".file-upload-indicator"),g=o.fileActionSettings,et=o.filestack.length>0||!n.isEmptyObject(o.uploadExtraData),l,nt,tt,it,rt,ut,ft,s={id:a,index:i};(o.formdata=p,y===0||!et||v.hasClass("disabled")||o.abort(s))||(k=function(){var n=o.$preview.find(u+".file-uploading");n.length>0&&o.fileBatchCompleted||(t.set(o.id,o.uploadCache.content,o.uploadCache.config,o.uploadCache.tags,o.uploadCache.append),o.hasInitData&&(o.initPreview(),o.initPreviewDeletes()),o.setProgress(100),o.unlock(),o.clearFileInput(),o.raise("filebatchuploadcomplete",[o.filestack,o.getExtraData()]),o.fileBatchCompleted=!0)},l=function(n,t){d.html(g[n]);d.attr("title",g[t])},nt=function(){!e||y===0||o.uploadPercent>=100||(o.uploadCount+=1,b=80+Math.ceil(o.uploadCount*20/y),o.uploadPercent=Math.max(b,o.uploadPercent),o.setProgress(o.uploadPercent),o.initPreviewDeletes())},tt=function(){v.removeAttr("disabled");w.removeAttr("disabled");c.removeClass("file-uploading")},it=function(t){h=o.getOutData(t);l("indicatorLoading","indicatorLoadingTitle");r(c,"file-uploading");v.attr("disabled",!0);w.attr("disabled",!0);e||o.lock();o.raise("filepreupload",[h,a,i]);s=n.extend(s,h);o.abort(s)&&(t.abort(),o.setProgress(100))},rt=function(t,r,u){h=o.getOutData(u,t);s=n.extend(s,h);setTimeout(function(){t.error===undefined?(l("indicatorSuccess","indicatorSuccessTitle"),v.hide(),w.hide(),o.filestack[i]=undefined,o.raise("fileuploaded",[h,a,i]),o.initUploadSuccess(t,c,e),e||o.resetFileStack()):(l("indicatorError","indicatorErrorTitle"),o.showUploadError(t.error,s))},100)},ut=function(){setTimeout(function(){nt();tt();e?setTimeout(function(){k()},500):o.unlock(!1)},100)},ft=function(t,r,u){var h=o.parseError(t,u,e?f[i].name:null);l("indicatorError","indicatorErrorTitle");s=n.extend(s,o.getOutData(t));o.showUploadError(h,s)},p.append(o.uploadFileAttr,f[i]),p.append("file_id",i),o.ajaxSubmit(it,rt,ut,ft))},uploadBatch:function(){var t=this,e=t.filestack,h=e.length,o,p=t.filestack.length>0||!n.isEmptyObject(t.uploadExtraData),f,c,s,l,a,v,y;(t.formdata=new FormData,h!==0&&p&&!t.abort({}))&&(o=t.fileActionSettings,f=function(i,r,u){var f=n("#"+t.previewInitId+"-"+i).find(".file-upload-indicator");f.html(o[r]);f.attr("title",o[u])},s=function(i){var r=n("#"+t.previewInitId+"-"+i+":not(.file-preview-initial)"),u=r.find(".kv-file-upload"),f=r.find(".kv-file-delete");r.removeClass("file-uploading");u.removeAttr("disabled");f.removeAttr("disabled")},c=function(){n.each(e,function(n){t.filestack[n]=undefined});t.clearFileInput()},l=function(i){t.lock();var f=t.getOutData(i);t.showPreview&&t.$preview.find(u).each(function(){var t=n(this),i=t.find(".kv-file-upload"),u=t.find(".kv-file-remove");r(t,"file-uploading");i.attr("disabled",!0);u.attr("disabled",!0)});t.raise("filebatchpreupload",[f]);t.abort(f)&&i.abort()},a=function(r,e,o){var h=t.getOutData(o,r),l=i(r.errorkeys)?[]:r.errorkeys;r.error===undefined||i(r.error)?(t.raise("filebatchuploadsuccess",[h]),c(),t.showPreview?(t.$preview.find(".kv-file-upload").hide(),t.$preview.find(".kv-file-remove").hide(),t.$preview.find(u).each(function(){var i=n(this),t=i.attr("data-fileindex");f(t,"indicatorSuccess","indicatorSuccessTitle");s(t)}),t.initUploadSuccess(r)):t.reset()):(t.showPreview&&(t.$preview.find(u).each(function(){var r=n(this),i=parseInt(r.attr("data-fileindex"),10);if(s(i),l.length===0){f(i,"indicatorError","indicatorErrorTitle");return}n.inArray(i,l)!==-1?f(i,"indicatorError","indicatorErrorTitle"):(r.find(".kv-file-upload").hide(),r.find(".kv-file-remove").hide(),f(i,"indicatorSuccess","indicatorSuccessTitle"),t.filestack[i]=undefined)}),t.initUploadSuccess(r)),t.showUploadError(r.error,h,"filebatchuploaderror"))},v=function(){t.setProgress(100);t.unlock();t.raise("filebatchuploadcomplete",[t.filestack,t.getExtraData()]);t.clearFileInput()},y=function(i,r,e){var o=t.getOutData(i),s=t.parseError(i,e);(t.showUploadError(s,o,"filebatchuploaderror"),t.uploadFileCount=h-1,t.showPreview)&&(t.$preview.find(u).each(function(){var i=n(this),r=i.attr("data-fileindex");i.removeClass("file-uploading");t.filestack[r]!==undefined&&f(r,"indicatorError","indicatorErrorTitle")}),t.$preview.find(u).removeClass("file-uploading"),t.$preview.find(u+" .kv-file-upload").removeAttr("disabled"),t.$preview.find(u+" .kv-file-delete").removeAttr("disabled"))},n.each(e,function(n,r){i(e[n])||t.formdata.append(t.uploadFileAttr,r)}),t.ajaxSubmit(l,a,v,y))},uploadExtraOnly:function(){var n=this,t={},r,u,f,e;(n.formdata=new FormData,n.abort(t))||(r=function(i){n.lock();var r=n.getOutData(i);n.raise("filebatchpreupload",[r]);n.setProgress(50);t.data=r;t.xhr=i;n.abort(t)&&(i.abort(),n.setProgress(100))},u=function(t,r,u){var f=n.getOutData(u,t);t.error===undefined||i(t.error)?(n.raise("filebatchuploadsuccess",[f]),n.clearFileInput(),n.initUploadSuccess(t)):n.showUploadError(t.error,f,"filebatchuploaderror")},f=function(){n.setProgress(100);n.unlock();n.raise("filebatchuploadcomplete",[n.filestack,n.getExtraData()]);n.clearFileInput()},e=function(i,r,u){var f=n.getOutData(i),e=n.parseError(i,u);t.data=f;n.showUploadError(e,f,"filebatchuploaderror")},n.ajaxSubmit(r,u,f,e))},hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},resetErrors:function(n){var t=this,i=t.$errorContainer;t.isError=!1;t.$container.removeClass("has-error");i.html("");n?i.fadeOut("slow"):i.hide()},showFolderError:function(n){var t=this,i=t.$errorContainer;n&&(i.html(t.msgFoldersNotAllowed.repl("{n}",n)),i.fadeIn(800),r(t.$container,"has-error"),t.raise("filefoldererror",[n]))},showUploadError:function(n,t,i){var f=this,u=f.$errorContainer,e=i||"fileuploaderror";return u.find("ul").length===0?u.html("<ul><li>"+n+"<\/li><\/ul>"):u.find("ul").append("<li>"+n+"<\/li>"),u.fadeIn(800),f.raise(e,[t]),r(f.$container,"has-error"),!0},showError:function(n,t,i){var u=this,f=u.$errorContainer,e=i||"fileerror";return t=t||{},t.reader=u.reader,f.html(n),f.fadeIn(800),u.raise(e,[t]),u.isUploadable||u.clearFileInput(),r(u.$container,"has-error"),u.$btnUpload.attr("disabled",!0),!0},errorHandler:function(n,t){var i=this,r=n.target.error;switch(r.code){case r.NOT_FOUND_ERR:i.showError(i.msgFileNotFound.repl("{name}",t));break;case r.SECURITY_ERR:i.showError(i.msgFileSecured.repl("{name}",t));break;case r.NOT_READABLE_ERR:i.showError(i.msgFileNotReadable.repl("{name}",t));break;case r.ABORT_ERR:i.showError(i.msgFilePreviewAborted.repl("{name}",t));break;default:i.showError(i.msgFilePreviewError.repl("{name}",t))}},parseFileType:function(n){for(var e=this,o,u,t,r=0;r<a.length;r+=1)if(t=a[r],o=f(t,e.fileTypeSettings)?e.fileTypeSettings[t]:b[t],u=o(n.type,n.name)?t:"",!i(u))return u;return"other"},previewDefault:function(t,i,r){if(this.showPreview){var u=this,h=l.createObjectURL(t),e=n("#"+i),f=u.previewSettings.other,o=u.renderFileFooter(t.name,f.width),c=u.getPreviewTemplate("other"),a=i.slice(i.lastIndexOf("-")+1),s="";r===!0&&(s=" btn disabled",o+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"><\/i><\/div>');u.$preview.append("\n"+c.repl("{previewId}",i).repl("{frameClass}",s).repl("{fileindex}",a).repl("{caption}",u.slug(t.name)).repl("{width}",f.width).repl("{height}",f.height).repl("{type}",t.type).repl("{data}",h).repl("{footer}",o));e.on("load",function(){l.revokeObjectURL(e.attr("data"))})}},previewFile:function(n,t,r,u){if(this.showPreview){var e=this,o=e.parseFileType(n),h=e.slug(n.name),a,s,rt=e.allowedPreviewTypes,y=e.allowedPreviewMimeTypes,b=e.getPreviewTemplate(o),c=f(o,e.previewSettings)?e.previewSettings[o]:nt[o],k=parseInt(e.wrapTextLength,10),p=e.wrapIndicator,ut=rt.indexOf(o)>=0,w,d,ft=i(y)||!i(y)&&f(n.type,y),g=e.renderFileFooter(h,c.width),tt="",it=r.slice(r.lastIndexOf("-")+1);ut&&ft?(o==="text"?(s=vt(t.target.result),l.revokeObjectURL(u),s.length>k&&(w="text-"+v(),d=window.innerHeight*.75,tt=e.getLayoutTemplate("modal").repl("{id}",w).repl("{title}",h).repl("{height}",d).repl("{body}",s),p=p.repl("{title}",h).repl("{dialog}","$('#"+w+"').modal('show')"),s=s.substring(0,k-1)+p),a=b.repl("{previewId}",r).repl("{caption}",h).repl("{frameClass}","").repl("{type}",n.type).repl("{width}",c.width).repl("{height}",c.height).repl("{data}",s).repl("{footer}",g).repl("{fileindex}",it)+tt):a=b.repl("{previewId}",r).repl("{caption}",h).repl("{frameClass}","").repl("{type}",n.type).repl("{data}",u).repl("{width}",c.width).repl("{height}",c.height).repl("{footer}",g).repl("{fileindex}",it),e.$preview.append("\n"+a),e.autoSizeImage(r)):e.previewDefault(n,r)}},slugDefault:function(n){return i(n)?"":n.split(/(\\|\/)/g).pop().replace(/[^\w\-.\\\/ ]+/g,"")},getFileStack:function(){var n=this;return n.filestack.filter(function(n){return n!==undefined})},readFiles:function(t){function s(n){if(i(p.attr("multiple"))&&(e=1),n>=e){r.isUploadable&&r.filestack.length>0?r.raise("filebatchselected",[r.getFileStack()]):r.raise("filebatchselected",[t]);v.removeClass("loading");o.html("");return}var pt=g+n,rt=d+"-"+pt,at,nt=t[n],it=r.slug(nt.name),st=(nt.size||0)/1e3,ct,lt="",vt=l.createObjectURL(nt),ot=0,ht,tt,yt,ut,ft=r.allowedFileTypes,wt=i(ft)?"":ft.join(", "),et=r.allowedFileExtensions,bt=i(et)?"":et.join(", ");if(i(et)||(lt=new RegExp("\\.("+et.join("|")+")$","i")),st=st.toFixed(2),r.maxFileSize>0&&st>r.maxFileSize){tt=r.msgSizeTooLarge.repl("{name}",it).repl("{size}",st).repl("{maxSize}",r.maxFileSize);r.isError=a(tt,nt,rt,n);return}if(!i(ft)&&c(ft)){for(ht=0;ht<ft.length;ht+=1)yt=ft[ht],ct=h[yt],ut=ct!==undefined&&ct(nt.type,it),ot+=i(ut)?0:ut.length;if(ot===0){tt=r.msgInvalidFileType.repl("{name}",it).repl("{types}",wt);r.isError=a(tt,nt,rt,n);return}}if(ot===0&&!i(et)&&c(et)&&!i(lt)&&(ut=it.match(lt),ot+=i(ut)?0:ut.length,ot===0)){tt=r.msgInvalidFileExtension.repl("{name}",it).repl("{extensions}",bt);r.isError=a(tt,nt,rt,n);return}if(!r.showPreview){r.filestack.push(nt);setTimeout(s(n+1),100);r.raise("fileloaded",[nt,rt,n,u]);return}w.length>0&&FileReader!==undefined?(o.html(k.repl("{index}",n+1).repl("{files}",e)),v.addClass("loading"),u.onerror=function(n){r.errorHandler(n,it)},u.onload=function(n){r.previewFile(nt,n,rt,vt);r.initFileActions()},u.onloadend=function(){tt=y.repl("{index}",n+1).repl("{files}",e).repl("{percent}",50).repl("{name}",it);setTimeout(function(){o.html(tt);l.revokeObjectURL(vt)},100);setTimeout(function(){s(n+1);r.updateFileDetails(e)},100);r.raise("fileloaded",[nt,rt,n,u])},u.onprogress=function(t){if(t.lengthComputable){var i=t.loaded/t.total*100,r=Math.ceil(i);tt=y.repl("{index}",n+1).repl("{files}",e).repl("{percent}",r).repl("{name}",it);setTimeout(function(){o.html(tt)},100)}},at=f("text",h)?h.text:b.text,at(nt.type,it)?u.readAsText(nt,r.textEncoding):u.readAsArrayBuffer(nt)):(r.previewDefault(nt,rt),setTimeout(function(){s(n+1);r.updateFileDetails(e)},100),r.raise("fileloaded",[nt,rt,n,u]));r.filestack.push(nt)}this.reader=new FileReader;var r=this,p=r.$element,w=r.$preview,u=r.reader,v=r.$previewContainer,o=r.$previewStatus,k=r.msgLoading,y=r.msgProgress,d=r.previewInitId,e=t.length,h=r.fileTypeSettings,g=r.filestack.length,a=function(i,u,f,e){var o=n.extend(r.getOutData({},{},t),{id:f,index:e}),s={id:f,index:e,file:u,files:t};return r.previewDefault(u,f,!0),r.isUploadable?r.showUploadError(i,o):r.showError(i,s)};s(0);r.updateFileDetails(e,!1)},updateFileDetails:function(n){var i=this,e=i.msgSelected,o=i.$element,r=i.getFileStack(),s=o.val()||r.length&&r[0].name||"",u=i.slug(s),f=i.isUploadable?r.length:n,h=t.count(i.id)+f,c=f>1?e.repl("{n}",h):u;i.isError?(i.$previewContainer.removeClass("loading"),i.$previewStatus.html(""),i.$captionContainer.find(".kv-caption-icon").hide()):i.showFileIcon();i.setCaption(c,i.isError);i.$container.removeClass("file-input-new file-input-ajax-new");arguments.length===1&&i.raise("fileselect",[n,u]);t.count(i.id)&&i.initPreviewDeletes()},change:function(r){var u=this,s=u.$element,a;if(!u.isUploadable&&i(s.val())&&u.fileInputCleared){u.fileInputCleared=!1;return}u.fileInputCleared=!1;var f,v,h,y=u.$preview,p=arguments.length>1,e=p?r.originalEvent.dataTransfer.files:s.get(0).files,w=i(s.attr("multiple")),c=0,o,l=0,b=u.filestack.length,k=u.isUploadable,d=function(t,i,r,f){var o=n.extend(u.getOutData({},{},e),{id:r,index:f}),s={id:r,index:f,file:i,files:e};return u.isUploadable?u.showUploadError(t,o):u.showError(t,s)};if(u.reader=null,u.resetUpload(),u.hideFileIcon(),u.isUploadable&&u.$container.find(".file-drop-zone ."+u.dropZoneTitleClass).remove(),p)for(f=[];e[c];)o=e[c],o.type||o.size%4096!=0?f.push(o):l++,c++;else f=r.target.files===undefined?r.target&&r.target.value?[{name:r.target.value.replace(/^.+\\/,"")}]:[]:r.target.files;if(i(f)||f.length===0){k||u.clear();u.showFolderError(l);u.raise("fileselectnone");return}if(u.resetErrors(),(!k||w&&b>0)&&(!u.overwriteInitial&&t.count(u.id)?(a=t.out(u.id),y.html(a.content),u.setCaption(a.caption),u.initPreviewDeletes()):y.html(""),w&&b>0&&(u.filestack=[])),h=u.isUploadable?u.getFileStack().length+f.length:f.length,u.maxFileCount>0&&h>u.maxFileCount){v=u.msgFilesTooMany.repl("{m}",u.maxFileCount).repl("{n}",h);u.isError=d(v,null,null,null);u.$captionContainer.find(".kv-caption-icon").hide();u.$caption.html(u.msgValidationError);u.setEllipsis();u.$container.removeClass("file-input-new file-input-ajax-new");return}u.isIE9?u.updateFileDetails(1):u.readFiles(f);u.showFolderError(l)},autoSizeImage:function(n){var u=this,f=u.$preview,r=f.find("#"+n),t=r.find("img"),e,o,i;if(t.length)t.on("load",function(){e=r.width();o=f.width();e>o&&(t.css("width","100%"),r.css("width","97%"));i=t.closest(".file-preview-frame").find(".file-caption-name");i.length&&(i.width(t.width()),i.attr("title",i.text()));u.raise("fileimageloaded",n)})},setCaption:function(t,r){var u=this,o=r||!1,f,e;i(t)||u.$caption.length===0||(o?(f=n("<div>"+u.msgValidationError+"<\/div>").text(),e='<span class="'+u.msgValidationErrorClass+'">'+u.msgValidationErrorIcon+f+"<\/span>"):(f=n("<div>"+t+"<\/div>").text(),e=f+u.getLayoutTemplate("icon")),u.$caption.html(e),u.$caption.attr("title",f),u.$captionContainer.find(".file-caption-ellipsis").attr("title",f),u.setEllipsis())},initBrowse:function(n){var t=this;t.$btnFile=n.find(".btn-file");t.$btnFile.append(t.$element)},createContainer:function(){var t=this,i=n(document.createElement("span")).attr({"class":"file-input file-input-new"}).html(t.renderMain());return t.$element.before(i),t.initBrowse(i),i},refreshContainer:function(){var n=this,t=n.$container;t.before(n.$element);t.html(n.renderMain());n.initBrowse(t)},renderMain:function(){var n=this,t=n.isUploadable&&n.dropZoneEnabled?" file-drop-zone":"",i=n.showPreview?n.getLayoutTemplate("preview").repl("{class}",n.previewClass).repl("{dropClass}",t):"",r=n.isDisabled?n.captionClass+" file-caption-disabled":n.captionClass,u=n.captionTemplate.repl("{class}",r+" kv-fileinput-caption");return n.mainTemplate.repl("{class}",n.mainClass).repl("{preview}",i).repl("{caption}",u).repl("{upload}",n.renderUpload()).repl("{remove}",n.renderRemove()).repl("{cancel}",n.renderCancel()).repl("{browse}",n.renderBrowse())},renderBrowse:function(){var n=this,i=n.browseClass+" btn-file",t="";return n.isDisabled&&(t=" disabled "),'<div class="'+i+'"'+t+"> "+n.browseIcon+n.browseLabel+" <\/div>"},renderRemove:function(){var n=this,i=n.removeClass+" fileinput-remove fileinput-remove-button",t="";return n.showRemove?(n.isDisabled&&(t=" disabled "),'<button type="button" title="'+n.removeTitle+'" class="'+i+'"'+t+">"+n.removeIcon+n.removeLabel+"<\/button>"):""},renderCancel:function(){var n=this,t=n.cancelClass+" fileinput-cancel fileinput-cancel-button";return n.showCancel?'<button type="button" title="'+n.cancelTitle+'" class="hide '+t+'">'+n.cancelIcon+n.cancelLabel+"<\/button>":""},renderUpload:function(){var n=this,i=n.uploadClass+" kv-fileinput-upload fileinput-upload-button",t="";return n.showUpload?(n.isDisabled&&(t=" disabled "),!n.isUploadable||n.isDisabled?'<button type="submit" title="'+n.uploadTitle+'"class="'+i+'"'+t+">"+n.uploadIcon+n.uploadLabel+"<\/button>":'<a href="'+n.uploadUrl+'" title="'+n.uploadTitle+'" class="'+i+'"'+t+">"+n.uploadIcon+n.uploadLabel+"<\/a>"):""}};n.fn.fileinput=function(t){if(w()||h(9)){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var u=n(this),r=u.data("fileinput"),f=typeof t=="object"&&t;r||(r=new p(this,n.extend({},n.fn.fileinput.defaults,f,n(this).data())),u.data("fileinput",r));typeof t=="string"&&r[t].apply(r,i)})}};n.fn.fileinput.defaults={showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:d,previewTemplates:g,allowedPreviewTypes:a,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:nt,fileTypeSettings:b,previewFileIcon:'<i class="glyphicon glyphicon-file"><\/i>',browseIcon:'<i class="glyphicon glyphicon-folder-open"><\/i> &nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"><\/i> ',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"><\/i> ',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"><\/i> ',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},maxFileSize:0,minFileCount:0,maxFileCount:0,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"><\/i> ',msgErrorClass:"file-error-message",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]<\/span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0};n.fn.fileinput.locales={};n.fn.fileinput.locales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgSizeTooLarge:'File "{name}" (<b>{size} KB<\/b>) exceeds maximum allowed upload size of <b>{maxSize} KB<\/b>. Please retry your upload!',msgFilesTooLess:"You must select at least <b>{n}<\/b> {files} to upload. Please retry your upload!",msgFilesTooMany:"Number of files selected for upload <b>({n})<\/b> exceeds maximum allowed limit of <b>{m}<\/b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} files selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",dropZoneTitle:"Drag & drop files here &hellip;"};n.extend(n.fn.fileinput.defaults,n.fn.fileinput.locales.en);n.fn.fileinput.Constructor=p;n(document).ready(function(){var t=n("input.file[type=file]"),i=t.attr("type")?t.length:0;i>0&&t.fileinput()})})(window.jQuery);
//# sourceMappingURL=fileinput.min.js.map
